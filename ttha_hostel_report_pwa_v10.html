<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TTHA Hostel Report — PWA (v10)</title>
<link rel="manifest" href="manifest_v10.json">
<meta name="theme-color" content="#eef7ff">
<style>
:root{--bg:#f6fbff;--card:#fff;--muted:#516878;--accent:#0b6efd;--accent-2:#06b6d4}
body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#f8fcff,#eef7ff);color:#093145}
.container{max-width:980px;margin:18px auto;padding:18px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.h1{font-size:20px;font-weight:800;color:#063855}
.notice{background:#eef9ff;padding:10px;border-radius:8px;border:1px solid rgba(6,110,237,0.06);margin-bottom:12px}
.panel{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(7,29,50,0.06)}
.preview{white-space:pre-wrap;font-family:monospace;background:#f0fbff;padding:12px;border-radius:10px;color:#04293a;border:1px solid rgba(6,110,237,0.06);max-height:420px;overflow:auto}
.btn{padding:8px 10px;border-radius:8px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;cursor:pointer}
.small{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <div class="h1">TTHA Hostel Visit — PWA</div>
      <div class="small">Installable — Offline capable • Save / Load / Share</div>
    </div>
    <div id="installArea"></div>
  </div>

  <div class="notice">
    This is a Progressive Web App version. Click <strong>Install</strong> (if available) or add to Home Screen from your browser menu.
    The app works offline after first load.
  </div>

  <div class="panel" id="appArea">
    <!-- We embed the same form content (simplified for brevity) -->
    <div style="margin-bottom:8px"><label>Place: <input id="place" value="Romaa Palace"></label></div>
    <div style="margin-bottom:8px"><label>Date: <input id="date" type="date"></label></div>
    <div style="margin-bottom:8px"><label>Reached Auto: <input id="reachedChk" type="checkbox"></label> <input id="reachedTime" placeholder="5:45 PM"></div>
    <div style="margin-bottom:8px"><label>Out Auto: <input id="outChk" type="checkbox"></label> <input id="outTime" placeholder="8:00 PM"></div>
    <div style="margin-bottom:8px"><label>Sports Time: <input id="sportsTime" value="6:00 PM to 7:00 PM"></label></div>

    <div style="margin-top:10px">
      <button id="save" class="btn">Save</button>
      <button id="gen" class="btn">Generate</button>
      <button id="copy" class="btn">Copy</button>
      <button id="wa" class="btn">Open WhatsApp</button>
    </div>

    <h3>Preview</h3>
    <div id="preview" class="preview"></div>
  </div>

  <div style="margin-top:12px" class="small">PWA notes: first load must be online so service worker can install. Afterwards app works offline (files cached).</div>
</div>

<script>
// Minimal app logic (save/generate/copy/share) - adapted from previous versions
const q = id => document.getElementById(id)
q('date').value = new Date().toISOString().slice(0,10)

function nowTime(){ const d=new Date(); const h=d.getHours(); const m=String(d.getMinutes()).padStart(2,'0'); const ampm=h>=12?'PM':'AM'; const hh=((h+11)%12)+1; return `${hh}:${m} ${ampm}` }
q('reachedChk').onchange = ()=>{ if(q('reachedChk').checked) q('reachedTime').value = nowTime() }
q('outChk').onchange = ()=>{ if(q('outChk').checked) q('outTime').value = nowTime() }

function collect(){
  return {
    place: q('place').value||'Romaa Palace',
    date: q('date').value,
    reached: q('reachedTime').value,
    out: q('outTime').value,
    sports: q('sportsTime').value
  }
}

function formatDD(iso){ const p = iso.split('-'); return p[2]+'-'+p[1]+'-'+p[0] }

function generate(){
  const d = collect(); const L = []
  L.push(`*PLACE :* ${d.place}`)
  L.push(''); L.push(`*DATE :* ${d.date? formatDD(d.date): '—'}`); L.push('')
  L.push(`*Reached @* ${d.reached || '—'}`); L.push('')
  L.push(`*Out @* ${d.out || '—'}`); L.push('')
  L.push(`*Sports Time :* ${d.sports || '—'}`)
  q('preview').textContent = L.join('\\n')
  return q('preview').textContent
}

q('gen').onclick = ()=>{ generate(); alert('Preview updated') }
q('copy').onclick = ()=>{ const txt = generate(); navigator.clipboard.writeText(txt).then(()=>alert('Copied'), ()=>alert('Copy failed')) }
q('save').onclick = ()=>{ const d = collect(); if(!d.date) return alert('Pick date'); const all = JSON.parse(localStorage.getItem('ttha_pwa_v10')||'{}'); all[d.date]=d; localStorage.setItem('ttha_pwa_v10', JSON.stringify(all)); alert('Saved') }
q('wa').onclick = ()=>{ const txt = generate(); window.open('https://wa.me/?text='+encodeURIComponent(txt), '_blank') }

// PWA installation handling
let deferredPrompt = null;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  const btn = document.createElement('button');
  btn.textContent = 'Install';
  btn.className = 'btn';
  btn.onclick = async () => {
    btn.disabled = true;
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    deferredPrompt = null;
    btn.remove();
  };
  document.getElementById('installArea').appendChild(btn);
});

// Register service worker
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw_v10.js').then(()=> console.log('SW registered')).catch(err=> console.warn('SW failed', err))
}
</script>
</body>
</html>
